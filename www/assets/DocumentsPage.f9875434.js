import{Q as $,d as j}from"./date.58a3a886.js";import{u as A,bg as T,r as p,o as Y,m as c,c as E,d as H,w as l,f as u,e as a,ai as g,ag as _,Q as v,ah as L,ad as i,j as m,aN as R,ak as G,i as K,aa as O}from"./index.7d370b68.js";import{Q as J}from"./QBadge.8085eeea.js";import{Q as W,a as y}from"./QTable.e901fc7a.js";import{Q as X}from"./QPage.33970ec2.js";import{C as Z}from"./ClosePopup.65f0d47c.js";import{u as ee}from"./use-quasar.4d250c70.js";import{_ as te}from"./plugin-vue_export-helper.21dcd24c.js";import"./format.78fa8c6e.js";import"./QChip.73d90e1c.js";import"./QItemLabel.968a4bb9.js";import"./position-engine.0d968b18.js";import"./selection.af76a41f.js";const ae={class:"row items-center"},le=["href"],oe={__name:"DocumentsPage",setup(se){const r=ee(),h=A(),f=T(),n=p(!1),s=p([]),d=p(!1),b=async()=>{n.value=!0;try{await f.fetchDocuments()}catch{r.notify({type:"negative",message:"Failed to refresh documents"})}finally{n.value=!1}};Y(()=>{b()});const x=c(()=>h.userId),Q=c(()=>f.documents),k=c(()=>Number(x.value)),S=c(()=>Q.value.filter(o=>o.uploaded_by_user===k.value&&o.collection===4)),B=[{name:"file",required:!0,label:"File",field:"title",align:"left",sortable:!0},{name:"created_at",label:"Uploaded",field:"created_at",align:"center",sortable:!0},{name:"file_size",label:"Size",field:"file_size",align:"right",sortable:!0}],C={sortBy:"created_at",descending:!0,page:1,rowsPerPage:10},F=o=>j.formatDate(o,"YYYY-MM-DD HH:mm"),U=o=>{if(o===0)return"0 Bytes";const e=1024,t=["Bytes","KB","MB","GB"],w=Math.floor(Math.log(o)/Math.log(e));return`${parseFloat((o/e**w).toFixed(2))} ${t[w]}`},D=o=>{if(!o)return"";const e=o.split(".");return e.length>1?e.pop().toLowerCase():""},z=o=>{const e=D(o);return{json:"mdi-code-json",csv:"mdi-file-delimited",xls:"mdi-file-excel",xlsx:"mdi-file-excel"}[e]||"mdi-file"},M=()=>s.value.length>0?`${s.value.length} document(s) selected`:"",P=()=>{r.notify({type:"positive",message:"Document uploaded successfully"}),b()},q=()=>{r.notify({type:"negative",message:"Upload failed. Please contact the administrator."})},I=()=>{d.value=!0},N=async()=>{n.value=!0;const o=s.value.map(e=>e.id);try{await f.deleteDocuments(o),r.notify({type:"positive",message:"Documents deleted successfully"}),s.value=[],d.value=!1}catch{r.notify({type:"negative",message:"Error deleting documents"})}finally{n.value=!1}},V=()=>({url:`${O.defaults.baseURL}content_api/documents/`,method:"POST",fieldName:"file",formFields:[{name:"collection",value:4}],headers:[{name:"Authorization",value:`Bearer ${h.token.access}`},{name:"Accept",value:"application/json"}]});return(o,e)=>(E(),H(X,{class:"q-pa-md bg-grey-10"},{default:l(()=>[e[3]||(e[3]=u("div",{class:"text-h4 text-white q-mb-md"},"Ruzivoflow Documents",-1)),a(g,{dark:"",class:"q-mb-md"},{default:l(()=>[a(_,null,{default:l(()=>[a($,{label:"Upload a file","auto-upload":"",accept:".json,.csv,.xlsx,.xls","field-name":"file",factory:V,onUploaded:P,onFailed:q,flat:"",bordered:"",dark:"",class:"full-width"})]),_:1})]),_:1}),a(g,{dark:""},{default:l(()=>[a(W,{title:"Documents",flat:"",bordered:"","row-key":"id",rows:S.value,columns:B,pagination:C,loading:n.value,selection:"multiple",selected:s.value,"onUpdate:selected":e[0]||(e[0]=t=>s.value=t),"selected-rows-label":M,dark:""},{"top-right":l(()=>[a(v,{color:"red",icon:"delete",label:"Delete Selected",disable:!s.value.length,onClick:I,class:"q-ml-md"},null,8,["disable"])]),"body-cell-file":l(t=>[a(y,{props:t},{default:l(()=>[u("div",ae,[a(L,{name:z(t.row.file),class:"q-mr-sm"},null,8,["name"]),u("a",{href:t.row.file_url,target:"_blank",class:"text-primary"},i(t.row.title),9,le),a(J,{color:"grey",class:"q-ml-sm"},{default:l(()=>[m(i(D(t.row.file)),1)]),_:2},1024)])]),_:2},1032,["props"])]),"body-cell-created_at":l(t=>[a(y,{props:t},{default:l(()=>[m(i(F(t.row.created_at)),1)]),_:2},1032,["props"])]),"body-cell-file_size":l(t=>[a(y,{props:t},{default:l(()=>[m(i(U(t.row.file_size)),1)]),_:2},1032,["props"])]),_:1},8,["rows","loading","selected"])]),_:1}),a(R,{modelValue:d.value,"onUpdate:modelValue":e[1]||(e[1]=t=>d.value=t)},{default:l(()=>[a(g,{dark:""},{default:l(()=>[a(_,null,{default:l(()=>e[2]||(e[2]=[u("div",{class:"text-h6"},"Confirm Deletion",-1)])),_:1,__:[2]}),a(_,null,{default:l(()=>[m(" Are you sure you want to delete "+i(s.value.length)+" document(s)? ",1)]),_:1}),a(G,{align:"right"},{default:l(()=>[K(a(v,{flat:"",label:"Cancel"},null,512),[[Z]]),a(v,{color:"red",label:"Delete",onClick:N})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1,__:[3]}))}};var he=te(oe,[["__scopeId","data-v-76ad44bb"]]);export{he as default};
